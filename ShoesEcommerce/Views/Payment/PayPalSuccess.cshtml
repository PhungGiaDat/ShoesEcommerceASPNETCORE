@model ShoesEcommerce.ViewModels.Payment.PayPalSuccessViewModel

@{
    ViewData["Title"] = "Thanh toán thành công";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="success-page">
    <!-- Success Header -->
    <header class="success-header">
        <div class="success-icon">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
        </div>
        <h1>Thanh toán thành công!</h1>
        <p class="subtitle">Cảm ơn bạn đã mua hàng tại SPORTS Vietnam</p>
    </header>

    <div class="success-grid">
        <!-- Left Column: Order Summary -->
        <div class="order-card">
            <div class="card-section">
                <div class="order-header">
                    <div>
                        <span class="label">Mã đơn hàng</span>
                        <strong class="order-id">#@Model.OrderId</strong>
                    </div>
                    <span class="status-badge paid">@Model.PaymentStatus</span>
                </div>

                <!-- ✅ PayPal Transaction Details -->
                <div class="paypal-details">
                    <h4 class="paypal-title">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944 3.72a.77.77 0 0 1 .76-.654h6.897c2.294 0 4.107.657 5.386 1.955 1.197 1.217 1.656 2.933 1.365 5.104-.478 3.578-2.647 5.788-5.873 5.788H9.883l-.816 5.424z"/>
                        </svg>
                        Chi tiết giao dịch PayPal
                    </h4>
                    <div class="info-grid paypal-grid">
                        <div class="info-item">
                            <span class="label">Số hóa đơn (Invoice)</span>
                            <span class="value highlight">@Model.InvoiceNumber</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Mã giao dịch PayPal</span>
                            <span class="value mono highlight">@(string.IsNullOrEmpty(Model.PayPalTransactionId) ? Model.TransactionId : Model.PayPalTransactionId)</span>
                        </div>
                        @if (!string.IsNullOrEmpty(Model.PayPalOrderId))
                        {
                            <div class="info-item">
                                <span class="label">PayPal Order ID</span>
                                <span class="value mono">@Model.PayPalOrderId</span>
                            </div>
                        }
                        <div class="info-item">
                            <span class="label">Số tiền (VND)</span>
                            <span class="value amount">@Model.TotalAmount.ToString("N0") VND</span>
                        </div>
                        @if (Model.AmountInUSD.HasValue && Model.AmountInUSD > 0)
                        {
                            <div class="info-item">
                                <span class="label">Số tiền (USD)</span>
                                <span class="value">$@Model.AmountInUSD.Value.ToString("F2")</span>
                            </div>
                            <div class="info-item">
                                <span class="label">Tỷ giá</span>
                                <span class="value">1 USD = @((Model.ExchangeRate ?? 25000).ToString("N0")) VND</span>
                            </div>
                        }
                        <div class="info-item">
                            <span class="label">Thời gian thanh toán</span>
                            <span class="value">@(Model.PaidAt?.ToString("HH:mm:ss dd/MM/yyyy") ?? "N/A")</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Trạng thái hóa đơn</span>
                            <span class="value status-code success">@Model.InvoiceStatus - Thành công</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="divider"></div>

            <!-- Products -->
            <div class="card-section">
                <h3 class="section-title">Sản phẩm đã đặt</h3>
                <div class="product-list">
                    @foreach (var item in Model.Items)
                    {
                        <div class="product-row">
                            <div class="product-image">
                                <img src="@item.ImageUrl" alt="@item.ProductName" onerror="this.src='/images/no-image.svg'" />
                                <span class="qty-badge">@item.Quantity</span>
                            </div>
                            <div class="product-info">
                                <div class="product-name">@item.ProductName</div>
                                <div class="product-variant">@item.VariantColor · Size @item.VariantSize</div>
                            </div>
                            <div class="product-price">@item.LineTotal.ToString("N0") đ</div>
                        </div>
                    }
                </div>
            </div>

            <div class="divider"></div>

            <!-- Totals -->
            <div class="card-section totals-section">
                <div class="total-row">
                    <span>Tạm tính</span>
                    <span>@Model.Subtotal.ToString("N0") đ</span>
                </div>
                @if (Model.DiscountAmount > 0)
                {
                    <div class="total-row discount">
                        <span>Giảm giá</span>
                        <span>-@Model.DiscountAmount.ToString("N0") đ</span>
                    </div>
                }
                <div class="total-row shipping">
                    <span>Phí vận chuyển</span>
                    <span class="free">Miễn phí</span>
                </div>
                <div class="total-row grand-total">
                    <span>Tổng thanh toán</span>
                    <span>@Model.TotalAmount.ToString("N0") đ</span>
                </div>
            </div>
        </div>

        <!-- Right Column: Shipping & Actions -->
        <div class="side-column">
            <!-- Shipping Address -->
            <div class="shipping-card">
                <h3 class="section-title">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                        <circle cx="12" cy="10" r="3"/>
                    </svg>
                    Địa chỉ giao hàng
                </h3>
                <div class="shipping-info">
                    <div class="shipping-name">@Model.ShippingFullName</div>
                    <div class="shipping-phone">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                        </svg>
                        @Model.ShippingPhone
                    </div>
                    <div class="shipping-address">@Model.ShippingAddress, @Model.ShippingDistrict, @Model.ShippingCity</div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <a href="@Url.Action("Index", "Order")" class="btn-primary">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                    </svg>
                    Xem đơn hàng của tôi
                </a>
                <a href="@Url.Action("Index", "Home")" class="btn-secondary">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9 22 9 12 15 12 15 22"/>
                    </svg>
                    Tiếp tục mua sắm
                </a>
            </div>

            <!-- Info Box -->
            <div class="info-box">
                <h4>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="16" x2="12" y2="12"/>
                        <line x1="12" y1="8" x2="12.01" y2="8"/>
                    </svg>
                    Thông tin quan trọng
                </h4>
                <ul>
                    <li>Đơn hàng sẽ được xử lý trong 1-2 ngày làm việc</li>
                    <li>Thời gian giao hàng dự kiến: 3-5 ngày</li>
                    <li>Email xác nhận đã được gửi đến bạn</li>
                    @if (!string.IsNullOrEmpty(Model.TransactionId))
                    {
                        <li>Mã giao dịch <code>@Model.TransactionId</code> có thể tra cứu trên PayPal</li>
                    }
                </ul>
            </div>
        </div>
    </div>
</div>

@section Styles {
<style>
    :root {
        --bg: #f5f5f5;
        --card: #ffffff;
        --text: #1a1a1a;
        --muted: #6b7280;
        --border: #e5e7eb;
        --accent: #c41e3a;
        --success: #10b981;
        --dark: #1a1a1a;
        --radius: 12px;
        --paypal-blue: #003087;
        --paypal-light: #e8f0fe;
    }

    .success-page { max-width: 1100px; margin: 0 auto; padding: 40px 20px 60px; }

    .success-header { text-align: center; margin-bottom: 32px; }
    .success-icon { width: 80px; height: 80px; background: #ecfdf5; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; color: var(--success); animation: scaleIn 0.5s ease; }
    .success-header h1 { font-size: 28px; font-weight: 700; color: var(--text); margin: 0 0 8px; }
    .success-header .subtitle { color: var(--muted); font-size: 16px; margin: 0; }

    @@keyframes scaleIn { from { transform: scale(0); } to { transform: scale(1); } }

    .success-grid { display: grid; grid-template-columns: 1.3fr 0.7fr; gap: 24px; align-items: start; }

    .order-card, .shipping-card, .info-box { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); }
    .order-card { padding: 0; }
    .card-section { padding: 24px; }
    .divider { height: 1px; background: var(--border); }

    .order-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .order-header .label { font-size: 13px; color: var(--muted); display: block; }
    .order-id { font-size: 24px; color: var(--text); }
    .status-badge { padding: 6px 12px; border-radius: 999px; font-size: 13px; font-weight: 600; }
    .status-badge.paid { background: #ecfdf5; color: var(--success); }

    /* ✅ PayPal Details Section */
    .paypal-details { background: linear-gradient(135deg, var(--paypal-light) 0%, #f0f6ff 100%); border: 1px solid #bdd4f7; border-radius: 10px; padding: 20px; margin-top: 16px; }
    .paypal-title { display: flex; align-items: center; gap: 10px; font-size: 15px; font-weight: 600; color: var(--paypal-blue); margin: 0 0 16px; padding-bottom: 12px; border-bottom: 1px dashed #bdd4f7; }
    .paypal-grid { grid-template-columns: 1fr 1fr; }

    .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .info-item .label { display: block; font-size: 11px; color: var(--muted); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.3px; }
    .info-item .value { font-weight: 600; color: var(--text); font-size: 14px; display: block; }
    .info-item .value.mono { font-family: 'SF Mono', 'Consolas', monospace; background: #f3f4f6; padding: 4px 8px; border-radius: 4px; font-size: 12px; word-break: break-all; }
    .info-item .value.highlight { color: var(--paypal-blue); font-size: 15px; }
    .info-item .value.amount { color: var(--success); font-size: 16px; }
    .info-item .value.status-code { background: #ecfdf5; color: var(--success); padding: 4px 10px; border-radius: 4px; font-size: 13px; }

    .section-title { font-size: 16px; font-weight: 600; color: var(--text); margin: 0 0 16px; display: flex; align-items: center; gap: 8px; }

    .product-list { display: flex; flex-direction: column; gap: 16px; }
    .product-row { display: grid; grid-template-columns: auto 1fr auto; gap: 14px; align-items: center; }
    .product-image { position: relative; width: 56px; height: 56px; border-radius: 10px; overflow: hidden; border: 1px solid var(--border); background: #f9fafb; }
    .product-image img { width: 100%; height: 100%; object-fit: cover; }
    .qty-badge { position: absolute; top: -6px; right: -6px; background: var(--dark); color: #fff; padding: 2px 6px; border-radius: 999px; font-size: 11px; font-weight: 700; }
    .product-info .product-name { font-weight: 600; font-size: 14px; color: var(--text); margin-bottom: 2px; }
    .product-info .product-variant { font-size: 13px; color: var(--muted); }
    .product-price { font-weight: 600; color: var(--text); white-space: nowrap; }

    .totals-section { }
    .total-row { display: flex; justify-content: space-between; padding: 8px 0; font-size: 14px; color: var(--text); }
    .total-row.discount { color: var(--success); }
    .total-row .free { color: var(--success); }
    .total-row.grand-total { font-size: 18px; font-weight: 700; padding-top: 12px; margin-top: 4px; border-top: 1px solid var(--border); }

    .side-column { display: flex; flex-direction: column; gap: 16px; position: sticky; top: 100px; }

    .shipping-card { padding: 20px; }
    .shipping-info { margin-top: 12px; }
    .shipping-name { font-weight: 600; font-size: 15px; color: var(--text); margin-bottom: 6px; }
    .shipping-phone { display: flex; align-items: center; gap: 6px; font-size: 14px; color: var(--muted); margin-bottom: 6px; }
    .shipping-address { font-size: 14px; color: var(--muted); line-height: 1.5; }

    .action-buttons { display: flex; flex-direction: column; gap: 10px; }
    .btn-primary, .btn-secondary { display: flex; align-items: center; justify-content: center; gap: 8px; padding: 14px 20px; border-radius: 10px; font-weight: 600; font-size: 15px; text-decoration: none; transition: all 0.2s ease; }
    .btn-primary { background: var(--dark); color: #fff; }
    .btn-primary:hover { background: var(--accent); }
    .btn-secondary { background: #fff; color: var(--text); border: 1px solid var(--border); }
    .btn-secondary:hover { background: #f9fafb; }

    .info-box { padding: 20px; background: #fffbeb; border-color: #fef3c7; }
    .info-box h4 { display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 600; color: #b45309; margin: 0 0 12px; }
    .info-box ul { margin: 0; padding-left: 20px; }
    .info-box li { font-size: 13px; color: #92400e; margin-bottom: 6px; line-height: 1.5; }
    .info-box li:last-child { margin-bottom: 0; }
    .info-box code { background: #fff; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-family: monospace; }

    @@media (max-width: 900px) {
        .success-grid { grid-template-columns: 1fr; }
        .side-column { position: static; }
        .info-grid, .paypal-grid { grid-template-columns: 1fr; }
    }
    s
    @@media (max-width: 640px) {
        .success-page { padding: 24px 16px 40px; }
        .success-header h1 { font-size: 22px; }
        .order-id { font-size: 20px; }
        .card-section { padding: 16px; }
        .product-row { grid-template-columns: auto 1fr; }
        .product-price { grid-column: 2; margin-top: -4px; font-size: 14px; }
        .paypal-details { padding: 16px; }
    }
</style>
}

@section Scripts {
<script>
    // Log PayPal transaction details
    console.log('=== PayPal Payment Success ===');
    console.log('Order ID:', @Model.OrderId);
    console.log('Invoice Number:', '@Model.InvoiceNumber');
    console.log('Transaction ID:', '@Model.TransactionId');
    console.log('PayPal Order ID:', '@Model.PayPalOrderId');
    console.log('PayPal Token:', '@Model.PayPalToken');
    console.log('Amount (VND):', @Model.TotalAmount);
    @if (Model.AmountInUSD.HasValue)
    {
        <text>console.log('Amount (USD):', @Model.AmountInUSD);</text>
    }
    console.log('============================');
</script>
}
