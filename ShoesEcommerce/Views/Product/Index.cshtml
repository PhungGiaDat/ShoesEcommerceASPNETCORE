@model ShoesEcommerce.ViewModels.Product.ProductListViewModel
@{
    ViewData["Title"] = ViewData["Title"] ?? "Tất Cả Sản Phẩm";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@Html.AntiForgeryToken()

<!-- Breadcrumb -->
<section class="breadcrumb-section">
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="/">Trang chủ</a></li>
                <li class="breadcrumb-item"><a href="/san-pham">Danh mục</a></li>
                <li class="breadcrumb-item active">@ViewData["Title"]</li>
            </ol>
        </nav>
    </div>
</section>

<div class="products-page">
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar Filters -->
            <div class="col-lg-3 col-md-4">
                <aside class="filter-sidebar">
                    <!-- Category Filter -->
                    <div class="filter-section">
                        <h4 class="filter-title">
                            DANH MỤC
                            <i class="fas fa-chevron-down"></i>
                        </h4>
                        <div class="filter-content">
                            <div class="category-tags">
                                <a href="/san-pham?category=nike-mercurial" class="category-tag">Nike zoom mercurial</a>
                                <a href="/san-pham?category=mizuno" class="category-tag">Mizuno</a>
                                <a href="/san-pham?category=adidas-predator" class="category-tag">Adidas Predator</a>
                                <a href="/san-pham?category=giay-co-nhan-tao" class="category-tag">Giày sân cỏ nhân tạo</a>
                                <a href="/san-pham?category=joma" class="category-tag">Joma Top Flex</a>
                                <a href="/san-pham?category=futsal" class="category-tag">Giày futsal</a>
                                <a href="/khuyen-mai" class="category-tag hot">Sản phẩm Hot Deal</a>
                                <a href="/san-pham?category=phu-kien" class="category-tag">Quần áo / Phụ kiện</a>
                            </div>
                        </div>
                    </div>

                    <!-- Price Filter -->
                    <div class="filter-section">
                        <h4 class="filter-title">
                            GIÁ
                            <i class="fas fa-chevron-down"></i>
                        </h4>
                        <div class="filter-content">
                            <div class="price-ranges">
                                <label class="price-option">
                                    <input type="radio" name="priceRange" value="0-1000000">
                                    <span>Dưới 1.000.000₫</span>
                                </label>
                                <label class="price-option">
                                    <input type="radio" name="priceRange" value="1000000-2000000">
                                    <span>1.000.000₫ - 2.000.000₫</span>
                                </label>
                                <label class="price-option">
                                    <input type="radio" name="priceRange" value="2000000-3000000">
                                    <span>2.000.000₫ - 3.000.000₫</span>
                                </label>
                                <label class="price-option">
                                    <input type="radio" name="priceRange" value="3000000+">
                                    <span>Trên 3.000.000₫</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Brand Filter -->
                    <div class="filter-section">
                        <h4 class="filter-title">
                            THƯƠNG HIỆU
                            <i class="fas fa-chevron-down"></i>
                        </h4>
                        <div class="filter-content">
                            <div class="brand-list">
                                @if (ViewBag.Brands != null)
                                {
                                    var selectedBrandId = ViewData["BrandFilter"]?.ToString();
                                    @foreach (var brand in ViewBag.Brands)
                                    {
                                        <label class="brand-option @(brand.Id.ToString() == selectedBrandId ? "active" : "")">
                                            <input type="checkbox" name="brandId" value="@brand.Id" @(brand.Id.ToString() == selectedBrandId ? "checked" : "")>
                                            <span>@brand.Name</span>
                                        </label>
                                    }
                                }
                            </div>
                        </div>
                    </div>

                    <!-- Size Filter -->
                    <div class="filter-section">
                        <h4 class="filter-title">
                            SIZE
                            <i class="fas fa-chevron-down"></i>
                        </h4>
                        <div class="filter-content">
                            <div class="size-grid">
                                @for (int i = 38; i <= 45; i++)
                                {
                                    <button class="size-btn" data-size="@i">@i</button>
                                }
                            </div>
                        </div>
                    </div>
                </aside>
            </div>

            <!-- Main Content -->
            <div class="col-lg-9 col-md-8">
                <!-- Banner -->
                <div class="category-banner">
                    <img src="/images/banners/product-banner.jpg" alt="Sản phẩm" onerror="this.parentElement.style.background='linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)'; this.style.display='none';">
                </div>

                <!-- Filter Bar -->
                <div class="filter-bar">
                    <h2 class="page-title">@ViewData["Title"]?.ToString()?.ToUpper()</h2>
                    <div class="filter-actions">
                        <div class="brand-quick-filter">
                            <a href="/san-pham?brand=Adidas" class="brand-filter-btn">ADIDAS</a>
                            <a href="/san-pham?brand=Nike" class="brand-filter-btn">NIKE</a>
                            <a href="/san-pham?brand=Puma" class="brand-filter-btn">PUMA</a>
                            <a href="/san-pham?brand=Mizuno" class="brand-filter-btn">MIZUNO</a>
                        </div>
                        <div class="sort-dropdown">
                            <span>Sắp xếp theo:</span>
                            <select class="form-select" id="sortSelect">
                                <option value="featured">Sản phẩm nổi bật</option>
                                <option value="newest">Mới nhất</option>
                                <option value="price-asc">Giá: Thấp đến cao</option>
                                <option value="price-desc">Giá: Cao đến thấp</option>
                            </select>
                        </div>
                    </div>
                </div>

                @if (Model.Products != null && Model.Products.Any())
                {
                    <div class="products-info">
                        <p>Hiển thị <strong>@Model.Products.Count()</strong> sản phẩm trong tổng số <strong>@Model.TotalItems</strong> sản phẩm</p>
                    </div>

                    <!-- Products Grid -->
                    <div class="row g-3" id="productContainer">
                        @foreach (var product in Model.Products)
                        {
                            <div class="col-6 col-lg-4 col-xl-3 product-item">
                                <article class="product-card">
                                    <a href="@Url.Action("Details", "Product", new { id = product.Id })" class="product-link">
                                        <div class="product-image">
                                            <img src="@(string.IsNullOrEmpty(product.ImageUrl) ? "/images/no-image.svg" : product.ImageUrl)" 
                                                 alt="@product.Name" 
                                                 loading="lazy"
                                                 onerror="this.src='/images/no-image.svg'">
                                            
                                            @if (product.HasActiveDiscount)
                                            {
                                                <span class="badge-discount">-@(product.DiscountPercentage?.ToString("F0"))%</span>
                                            }

                                            <div class="product-overlay">
                                                <button type="button" class="btn-quick-view" data-product-id="@product.Id">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button type="button" class="btn-favorite" data-product-id="@product.Id">
                                                    <i class="fas fa-heart"></i>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <div class="product-info">
                                            <span class="product-brand">@product.BrandName</span>
                                            <h3 class="product-name">@product.Name</h3>
                                            <div class="product-price">
                                                @if (product.HasActiveDiscount)
                                                {
                                                    <span class="price-sale">@product.DiscountedMinPrice.ToString("N0")₫</span>
                                                    <span class="price-original">@product.MinPrice.ToString("N0")₫</span>
                                                }
                                                else
                                                {
                                                    <span class="price-current">@product.MinPrice.ToString("N0")₫</span>
                                                    @if (product.MinPrice != product.MaxPrice)
                                                    {
                                                        <span class="price-range">- @product.MaxPrice.ToString("N0")₫</span>
                                                    }
                                                }
                                            </div>
                                        </div>
                                    </a>
                                </article>
                            </div>
                        }
                    </div>

                    <!-- Pagination -->
                    @if (Model.TotalPages > 1)
                    {
                        <nav class="pagination-nav" aria-label="Product pagination">
                            <ul class="pagination justify-content-center">
                                @{
                                    var currentPage = Model.CurrentPage;
                                    var totalPages = Model.TotalPages;
                                    var searchString = ViewData["CurrentFilter"]?.ToString();
                                    var categoryFilter = ViewData["CategoryFilter"]?.ToString();
                                    var brandFilter = ViewData["BrandFilter"]?.ToString();
                                    var actionName = Model.ShowDiscountsOnly ? "DiscountedProducts" : "Index";
                                }

                                <li class="page-item @(currentPage <= 1 ? "disabled" : "")">
                                    <a class="page-link" href="@Url.Action(actionName, new { page = currentPage - 1, searchString, categoryId = categoryFilter, brandId = brandFilter })">
                                        <i class="fas fa-chevron-left"></i>
                                    </a>
                                </li>

                                @for (int i = Math.Max(1, currentPage - 2); i <= Math.Min(totalPages, currentPage + 2); i++)
                                {
                                    <li class="page-item @(i == currentPage ? "active" : "")">
                                        <a class="page-link" href="@Url.Action(actionName, new { page = i, searchString, categoryId = categoryFilter, brandId = brandFilter })">@i</a>
                                    </li>
                                }

                                <li class="page-item @(currentPage >= totalPages ? "disabled" : "")">
                                    <a class="page-link" href="@Url.Action(actionName, new { page = currentPage + 1, searchString, categoryId = categoryFilter, brandId = brandFilter })">
                                        <i class="fas fa-chevron-right"></i>
                                    </a>
                                </li>
                            </ul>
                            <div class="pagination-info">
                                Trang @currentPage / @totalPages (@Model.TotalItems sản phẩm)
                            </div>
                        </nav>
                    }
                }
                else
                {
                    <div class="empty-state">
                        <i class="fas fa-box-open"></i>
                        <h4>Không tìm thấy sản phẩm</h4>
                        <p>Hãy thử thay đổi bộ lọc hoặc từ khóa tìm kiếm</p>
                        <a href="/san-pham" class="btn-reset">
                            <i class="fas fa-undo"></i> Xóa bộ lọc
                        </a>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<!-- Sports Product Page Styles -->
<style>
    /* Breadcrumb */
    .breadcrumb-section {
        background: #f8f9fa;
        padding: 15px 0;
        border-bottom: 1px solid #eee;
    }

    .breadcrumb {
        font-size: 13px;
    }

    .breadcrumb-item a {
        color: #666;
        text-decoration: none;
    }

    .breadcrumb-item.active {
        color: #1a1a1a;
    }

    /* Products Page */
    .products-page {
        padding: 30px 0;
        background: #fff;
    }

    /* Filter Sidebar */
    .filter-sidebar {
        background: #fff;
        border: 1px solid #eee;
        border-radius: 10px;
        padding: 20px;
        position: sticky;
        top: 100px;
    }

    .filter-section {
        margin-bottom: 25px;
        border-bottom: 1px solid #eee;
        padding-bottom: 20px;
    }

    .filter-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }

    .filter-title {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        font-weight: 700;
        color: #1a1a1a;
        margin-bottom: 15px;
        cursor: pointer;
        background: #1a1a1a;
        color: #fff;
        padding: 10px 15px;
        border-radius: 5px;
    }

    .category-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }

    .category-tag {
        display: inline-block;
        padding: 8px 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 12px;
        color: #1a1a1a;
        text-decoration: none;
        transition: all 0.3s ease;
    }

    .category-tag:hover, .category-tag.active {
        background: #1a1a1a;
        color: #fff;
        border-color: #1a1a1a;
    }

    .category-tag.hot {
        background: #e63946;
        color: #fff;
        border-color: #e63946;
    }

    .price-ranges, .brand-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .price-option, .brand-option {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        font-size: 13px;
        color: #555;
    }

    .price-option input, .brand-option input {
        accent-color: #1a1a1a;
    }

    .size-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
    }

    .size-btn {
        padding: 10px;
        border: 1px solid #ddd;
        background: #fff;
        border-radius: 5px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .size-btn:hover, .size-btn.active {
        background: #1a1a1a;
        color: #fff;
        border-color: #1a1a1a;
    }

    /* Category Banner */
    .category-banner {
        height: 200px;
        border-radius: 10px;
        overflow: hidden;
        margin-bottom: 25px;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    }

    .category-banner img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* Filter Bar */
    .filter-bar {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 2px solid #eee;
        gap: 15px;
    }

    .page-title {
        font-size: 22px;
        font-weight: 800;
        color: #1a1a1a;
        margin: 0;
    }

    .filter-actions {
        display: flex;
        align-items: center;
        gap: 20px;
        flex-wrap: wrap;
    }

    .brand-quick-filter {
        display: flex;
        gap: 8px;
    }

    .brand-filter-btn {
        padding: 8px 20px;
        border: 2px solid #1a1a1a;
        border-radius: 25px;
        font-size: 12px;
        font-weight: 700;
        color: #1a1a1a;
        text-decoration: none;
        transition: all 0.3s ease;
    }

    .brand-filter-btn:hover {
        background: #1a1a1a;
        color: #fff;
    }

    .sort-dropdown {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 13px;
    }

    .sort-dropdown .form-select {
        width: auto;
        border-radius: 25px;
        padding: 8px 35px 8px 15px;
        border-color: #ddd;
        font-size: 13px;
    }

    .products-info {
        margin-bottom: 20px;
        font-size: 14px;
        color: #666;
    }

    /* Product Card */
    .product-card {
        background: #fff;
        border-radius: 10px;
        overflow: hidden;
        transition: all 0.3s ease;
        border: 1px solid #eee;
        height: 100%;
    }

    .product-card:hover {
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        transform: translateY(-5px);
    }

    .product-link {
        text-decoration: none;
        color: inherit;
        display: block;
    }

    .product-image {
        position: relative;
        padding-top: 100%;
        overflow: hidden;
        background: #f8f9fa;
    }

    .product-image img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }

    .product-card:hover .product-image img {
        transform: scale(1.1);
    }

    .badge-discount {
        position: absolute;
        top: 10px;
        left: 10px;
        background: #e63946;
        color: #fff;
        padding: 5px 12px;
        border-radius: 5px;
        font-size: 12px;
        font-weight: 700;
    }

    .badge-new {
        position: absolute;
        top: 10px;
        right: 10px;
        background: #1a1a1a;
        color: #fff;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 10px;
        font-weight: 600;
    }

    .product-overlay {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .product-card:hover .product-overlay {
        opacity: 1;
    }

    .btn-quick-view, .btn-favorite {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: none;
        background: #fff;
        color: #1a1a1a;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }

    .btn-quick-view:hover, .btn-favorite:hover {
        background: #e63946;
        color: #fff;
    }

    .product-info {
        padding: 15px;
    }

    .product-brand {
        display: block;
        font-size: 11px;
        color: #999;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 5px;
    }

    .product-name {
        font-size: 14px;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 10px;
        line-height: 1.4;
        height: 40px;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }

    .product-price {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
    }

    .price-sale {
        font-size: 16px;
        font-weight: 700;
        color: #e63946;
    }

    .price-original {
        font-size: 13px;
        color: #999;
        text-decoration: line-through;
    }

    .price-current {
        font-size: 16px;
        font-weight: 700;
        color: #1a1a1a;
    }

    .price-range {
        font-size: 14px;
        color: #1a1a1a;
    }

    /* Pagination */
    .pagination-nav {
        margin-top: 40px;
        text-align: center;
    }

    .pagination {
        gap: 5px;
    }

    .pagination .page-link {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        border: 1px solid #ddd;
        color: #1a1a1a;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .pagination .page-item.active .page-link {
        background: #1a1a1a;
        border-color: #1a1a1a;
        color: #fff;
    }

    .pagination .page-link:hover {
        background: #f0f0f0;
    }

    .pagination-info {
        margin-top: 15px;
        font-size: 13px;
        color: #666;
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 80px 20px;
    }

    .empty-state i {
        font-size: 80px;
        color: #ddd;
        margin-bottom: 20px;
    }

    .empty-state h4 {
        color: #1a1a1a;
        margin-bottom: 10px;
    }

    .empty-state p {
        color: #666;
        margin-bottom: 25px;
    }

    .btn-reset {
        display: inline-block;
        padding: 12px 30px;
        background: #1a1a1a;
        color: #fff;
        border-radius: 25px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .btn-reset:hover {
        background: #e63946;
        color: #fff;
    }

    /* Mobile Responsive */
    @@media (max-width: 991px) {
        .filter-sidebar {
            display: none;
        }

        .brand-quick-filter {
            display: none;
        }
    }

    @@media (max-width: 768px) {
        .filter-bar {
            flex-direction: column;
            align-items: flex-start;
        }

        .filter-actions {
            width: 100%;
            justify-content: space-between;
        }

        .category-banner {
            height: 150px;
        }

        .page-title {
            font-size: 18px;
        }
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Filter toggles
    document.querySelectorAll('.filter-title').forEach(function(title) {
        title.addEventListener('click', function() {
            const content = this.nextElementSibling;
            const icon = this.querySelector('i');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.classList.remove('fa-chevron-right');
                icon.classList.add('fa-chevron-down');
            } else {
                content.style.display = 'none';
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-right');
            }
        });
    });

    // Size button toggle
    document.querySelectorAll('.size-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
            this.classList.toggle('active');
        });
    });

    // Sort change
    document.getElementById('sortSelect')?.addEventListener('change', function() {
        const url = new URL(window.location.href);
        url.searchParams.set('sort', this.value);
        window.location.href = url.toString();
    });
});
</script>